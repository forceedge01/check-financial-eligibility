{
  "id": "#{Rails.root}/config/api/assessment_schema.json",
  "$schema": "http://json-schema.org/draft-04/schema#",
  "title": "Legal Aid Check Financial Eligibility payload schema",
  "description": " defines the payload required to submit data to the Legal Aid Check Financial Eligibility API",


  "type": "object",
  "required": [
    "meta_data",
    "applicant",
    "applicant_income",
    "applicant_outgoings",
    "applicant_capital"
  ],
  "additionalProperties": false,


  "definitions": {
    "date": {
      "type": "string",
      "pattern": "^([12][9|0][0-9]{2}-(0[1-9]|1[0-2])-(0[1-9]|[12][0-9]|3[01]))$",
      "description": "Date in format YYYY-MM-DD in range 1900-01-01 to 2999-12-31"
    },
    "matter_proceeding_type": {
      "type": "string",
      "enum": ["Domestic abuse"],
      "description": "The matter proceeding type - the only one currently handled is 'Domestic abuse'"
    },
    "applicant_involvement_type": {
      "type": "string",
      "enum": ["applicant", "defendant"],
      "description": "The type of involvement of the applicant in the case."
    },
    "number_with_two_decimals": {
      "type": "number",
      "multipleOf": 0.01,
      "minimum": 0.00,
      "description": "Non-negative number (including zero) with two decimal places"
    },
    "benefit_name": {
      "description": "Name of benefit received - must be one of the values listed in the enum below",
      "type": "string",
      "enum": ["child_allowance", "jobseekers_allowance"]
    },
    "dependent": {
      "type": "object",
      "required": [
        "date_of_birth",
        "in_full_time_education"
      ],
      "additionalProperties": false,
      "properties": {
        "date_of_birth": {
          "$ref": "#/definitions/date",
          "description": "Date of birth of the dependent"
        },
        "in_full_time_education": {
          "type": "boolean",
          "description": "Whether or not the dependent is in full time education"
        },
        "income": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/dependent_income"
          },
          "description": "Optional array of income objects defining the income the dependent received during the calculation period"
        }
      }
    },
    "dependent_income": {
      "type": "object",
      "required": [
        "date_of_payment",
        "amount"
      ],
      "properties": {
        "date_of_payment": {
          "$ref": "#/definitions/date",
          "description": "the date upon which the dependent received this income"
        },
        "amount": {
          "$ref": "#/definitions/number_with_two_decimals"
        }
      }
    },
    "applicant_wage_slip": {
      "type": "object",
      "required": [
        "date",
        "gross_pay",
        "paye",
        "national_insurance_contribution"
      ],
      "additionalProperties": false,
      "properties": {
        "date": {
          "$ref": "#/definitions/date"
        },
        "gross_pay": {
          "$ref": "#/definitions/number_with_two_decimals"
        },
        "paye": {
          "$ref": "#/definitions/number_with_two_decimals"
        },
        "national_insurance_contribution": {
          "$ref": "#/definitions/number_with_two_decimals"
        }
      }
    },
    "applicant_benefit_payment": {
      "type": "object",
      "required": [
        "benefit_name",
        "payment_date",
        "amount"
      ],
      "additionalProperties": false,
      "properties": {
        "benefit_name": {
          "$ref": "#/definitions/benefit_name"
        },
        "payment_date": {
          "$ref": "#/definitions/date"
        },
        "amount": {
          "$ref": "#/definitions/number_with_two_decimals"
        }
      }
    },
    "applicant_outgoing": {
      "description": "Describes an allowable outgoing during the calculation period",
      "required": [
        "type_of_outgoing",
        "payment_date",
        "amount"
      ],
      "additionalProperties": false,
      "properties": {
        "type_of_outgoing": {
          "description": "The type of allowable outgoing - must be one of the values listed below",
          "type": "string",
          "enum": ["mortgage", "maintenance"]
        },
        "payment_date": {
          "description": "The date the payment was made",
          "$ref": "#/definitions/date"
        },
        "amount": {
          "description": "the amount paid in pounds and pence, e.g. 45.22",
          "$ref": "#/definitions/number_with_two_decimals"
        }
      }
    },
    "percentage_with_two_decimals": {
      "description": "Percentage in range 0.01 - 100.00",
      "type": "number",
      "multipleOf": 0.01,
      "minimum": 0.01,
      "maximum": 100.00
    },
    "property_details": {
      "description": "Defines value and ownership of the main dwellling or other property",
      "type": "object",
      "required": [
        "value",
        "outstanding_mortgage",
        "percentage_owned"
      ],
      "additionalProperties": false,
      "properties": {
        "value": {
          "$ref": "#/definitions/number_with_two_decimals"
        },
        "outstanding_mortgage": {
          "$ref": "#/definitions/number_with_two_decimals"
        },
        "percentage_owned": {
          "$ref": "#/definitions/percentage_with_two_decimals"
        }
      }
    },
    "applicant_property": {
      "description": "Describes the applicant's main home and additional properties",
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "main_home": {
          "$ref": "#/definitions/property_details"
        },
        "other_properties": {
          "description": "An array of property descriptions for any additional properties",
          "type": "array",
          "items": {
            "$ref": "#/definitions/property_details"
          }
        }
      }
    },
    "capital_item": {
      "description": "Definition of a liquid or non-liquid capital item",
      "type": "object",
      "required": [
        "item_description",
        "value"
      ],
      "additionalProperties": false,
      "properties": {
        "item_description": {
          "type": "string"
        },
        "value": {
          "$ref": "#/definitions/number_with_two_decimals"
        }
      }
    },
    "applicant_vehicle": {
      "description": "Details of an individual vehicle",
      "required": [
        "value",
        "loan_amount_outstanding"
      ],
      "additionalProperties": false,
      "properties": {
        "value": {
          "$ref": "#/definitions/number_with_two_decimals"
        },
        "loan_amount_outstanding": {
          "$ref": "#/definitions/number_with_two_decimals"
        }
      }
    },
    "applicant_liquid_capital": {
      "description": "Describes valuable items and vehicles",
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "valuable_items": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/capital_item"
          }
        },
        "vehicles": {
          "description": "Details of applicant vehicles",
          "type": "array",
          "items": {
            "$ref": "#/definitions/applicant_vehicle"
          }
        }
      }
    }
  },


  "properties": {
    "client_reference_id": {
      "description": "optional reference id by which the client can identify this request.  This value, if present, will be included in  the response along with a unique id generated by the Check Financial Eligibility service",
      "type": "string"
    },
    "submission_date": {
      "$ref": "#/definitions/date"
    },



    "meta_data": {
      "type": "object",
      "required": [
        "submission_date",
        "matter_proceeding_type"
      ],
      "additionalProperties": false,
      "properties": {
        "submission_date": {
          "$ref": "#/definitions/date"
        },
        "matter_proceeding_type": {
          "$ref": "#/definitions/matter_proceeding_type"
        }
      }
    },



    "applicant": {
      "type": "object",
      "required": [
        "date_of_birth",
        "involvement_type",
        "has_partner_opponent",
        "receives_qualifying_benefit",
        "dependents"
      ],
      "additionalProperties": false,
      "properties": {
        "date_of_birth": {
          "$ref": "#/definitions/date"
        },
        "involvement_type": {
          "$ref": "#/definitions/applicant_involvement_type"
        },
        "has_partner_opponent": {
          "type": "boolean",
          "description": "Whether or not the partner of the applicant is an opponent in the case"
        },
        "receives_qualifying_benefit": {
          "type": "boolean",
          "description": "Whether or not the applicant recieves a qualifying DWP benefit"
        },
        "dependents": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/dependent"
          }
        }
      }
    },



    "applicant_income": {
      "description": "Describes applicant income.  Comprises of two options objects: wage_slips and benefits",
      "type": "object",
      "properties": {
        "wage_slips": {
          "description": "Optional. An array of items describing each instance of employment income, tax and NI received during the calculation period",
          "type": "array",
          "items": {
            "$ref": "#/definitions/applicant_wage_slip"
          }
        },
        "benefits": {
          "description": "Optional. An array of items describing each benefit payment received during the calculation period",
          "type": "array",
          "items": {
            "$ref": "#/definitions/applicant_benefit_payment"
          }
        }
      }
    },



    "applicant_outgoings": {
      "description": "An array of objects describing the type of allowable outgoings",
      "type": "array",
      "minItems": 1,
      "items": {
        "$ref": "#/definitions/applicant_outgoing"
      }
    },



    "applicant_capital": {
      "description": "Describes the property and capital of the applicant",
      "additionalProperties": false,
      "properties": {
        "property": {
          "$ref": "#/definitions/applicant_property"
        },
        "liquid_capital": {
          "$ref": "#/definitions/applicant_liquid_capital"
        },
        "non_liquid_capital": {
          "description": "An array of objects describing applicant's non-liquid capital items (excluding property)",
          "type": "array",
          "items": {
            "$ref": "#/definitions/capital_item"
          }
        }
      }
    }
  }
}
